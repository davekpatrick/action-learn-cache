###############################################################################
## ------------------------------------------------------------------------- ##
## Terraform Root Module
## ------------------------------
## - main entry point
## ------------------------------------------------------------------------- ##
###############################################################################
# BOF
terraform {
  # Terraform version required for this module to function
  required_version = "~> 1.3"
  # ---------------------------------------------------
  # Setup providers
  # ---------------------------------------------------
  required_providers {
    #
    null = {
      source  = "registry.terraform.io/hashicorp/null"
      version = ">= 3.1.0"
    }
    #
    time = {
      source  = "registry.terraform.io/hashicorp/time"
      version = ">= 0.7.2"
    }
  }
  # ---------------------------------------------------
  # Setup state
  # ---------------------------------------------------
  backend "local" {
    path = "terraform.tfstate"
  }
  # ---------------------------------------------------
}
## ---------------------------------------------------
## Configure providers
## ---------------------------------------------------
provider "null" {}
provider "time" {}
###############################################################################
## ------------------------------------------------------------------------- ##
## Local
## ------------------------------------------------------------------------- ##
###############################################################################
locals {
  msg = "Hello, world!"
  # output setup
  out_today = formatdate(var.dateFormat, resource.time_static.today.id)
}
###############################################################################
## ------------------------------------------------------------------------- ##
## Data
## ------------------------------------------------------------------------- ##
###############################################################################
# None
###############################################################################
## ------------------------------------------------------------------------- ##
## Resource
## ------------------------------------------------------------------------- ##
###############################################################################
## --------------------------------------------------- d
resource "time_static" "today" {
  triggers = {
    "now" = timestamp()
  }
}
resource "null_resource" "default" {
  triggers = {
    "key" = resource.time_static.today.id
  }
  #
  provisioner "local-exec" {
    command = "echo ${local.msg} at ${local.out_today}"
  }
}
###############################################################################
## ------------------------------------------------------------------------- ##
###############################################################################
# EOF